<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>Numeric/NumType.lhs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
Numeric.NumType -- Type-level (low cardinality) integers
Bjorn Buckwalter, bjorn.buckwalter@gmail.com
License: BSD3


= Summary =

This Module provides unary type-level representations, hereafter
referred to as "NumTypes", of the (positive and negative) integers
and basic operations (addition, subtraction, multiplication, division)
on these. While functions are provided for the operations NumTypes
exist solely at the type level and their only value is 'undefined'.

There are similarities with the HNats of the HList library [1],
which was indeed a source of inspiration. Occasionally references
are made to the HNats. The main addition in this module is negative
numbers.

The practical size of the NumTypes is limited by the type checker
stack. If the NumTypes grow too large (which can happen quickly
with multiplication) an error message similar to the following will
be emitted:

    Context reduction stack overflow; size = 20
    Use -fcontext-stack=N to increase stack size to N

This situation could concievably be mitigated significantly by using
e.g. a binary representation of integers rather than Peano numbers.

Also, even if stack size is increased type-checker performance
quickly gets painfully slow. If you will be working with type-level
integers beyond (-20, 20) this module probably isn't for you. They
are, however, eminently suitably for applications such as representing
physical dimensions.


= Preliminaries =

This module requires GHC 6.6 or later. We utilize multi-parameter
type classes, phantom types, functional dependencies and undecidable
instances (and possibly additional unidentified GHC extensions).

<pre><a name="line-1"></a><span class='hs-varop'>&gt;</span> <span class='hs-comment'>{-# LANGUAGE UndecidableInstances
<a name="line-2"></a>&gt;            , ScopedTypeVariables
<a name="line-3"></a>&gt;            , EmptyDataDecls
<a name="line-4"></a>&gt;            , FunctionalDependencies
<a name="line-5"></a>&gt;            , MultiParamTypeClasses
<a name="line-6"></a>&gt;            , FlexibleInstances
<a name="line-7"></a>&gt;            , DeriveDataTypeable
<a name="line-8"></a>&gt; #-}</span>
</pre>
<pre><a name="line-1"></a><span class='hs-varop'>&gt;</span> <span class='hs-comment'>{- |
<a name="line-2"></a>&gt;    Copyright  : Copyright (C) 2006-2009 Bjorn Buckwalter
<a name="line-3"></a>&gt;    License    : BSD3
<a name="line-4"></a>&gt;
<a name="line-5"></a>&gt;    Maintainer : bjorn.buckwalter@gmail.com
<a name="line-6"></a>&gt;    Stability  : Stable
<a name="line-7"></a>&gt;    Portability: GHC only?
<a name="line-8"></a>&gt;
<a name="line-9"></a>&gt; Please refer to the literate Haskell code for documentation of both API
<a name="line-10"></a>&gt; and implementation.
<a name="line-11"></a>&gt; -}</span>
</pre>
<pre><a name="line-1"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>module</span> <span class='hs-conid'>Numeric</span><span class='hs-varop'>.</span><span class='hs-conid'>NumType</span>
<a name="line-2"></a><span class='hs-varop'>&gt;</span>   <span class='hs-comment'>-- Basic classes (exported versions).</span>
<a name="line-3"></a><span class='hs-varop'>&gt;</span>   <span class='hs-layout'>(</span> <span class='hs-conid'>NumType</span><span class='hs-layout'>,</span> <span class='hs-conid'>PosType</span><span class='hs-layout'>,</span> <span class='hs-conid'>NegType</span><span class='hs-layout'>,</span> <span class='hs-conid'>NonZero</span>
<a name="line-4"></a><span class='hs-varop'>&gt;</span>   <span class='hs-comment'>-- Arithmetic classes.</span>
<a name="line-5"></a><span class='hs-varop'>&gt;</span>   <span class='hs-layout'>,</span> <span class='hs-conid'>Succ</span><span class='hs-layout'>,</span> <span class='hs-conid'>Negate</span><span class='hs-layout'>,</span> <span class='hs-conid'>Sum</span><span class='hs-layout'>,</span> <span class='hs-conid'>Div</span><span class='hs-layout'>,</span> <span class='hs-conid'>Mul</span>
<a name="line-6"></a><span class='hs-varop'>&gt;</span>   <span class='hs-comment'>-- Functions.</span>
<a name="line-7"></a><span class='hs-varop'>&gt;</span>   <span class='hs-layout'>,</span> <span class='hs-varid'>toNum</span><span class='hs-layout'>,</span> <span class='hs-varid'>incr</span><span class='hs-layout'>,</span> <span class='hs-varid'>decr</span><span class='hs-layout'>,</span> <span class='hs-varid'>negate</span><span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varop'>+</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-comment'>-</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varop'>*</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varop'>/</span><span class='hs-layout'>)</span>
<a name="line-8"></a><span class='hs-varop'>&gt;</span>   <span class='hs-comment'>-- Data types.</span>
<a name="line-9"></a><span class='hs-varop'>&gt;</span>   <span class='hs-layout'>,</span> <span class='hs-conid'>Zero</span><span class='hs-layout'>,</span> <span class='hs-conid'>Pos</span><span class='hs-layout'>,</span> <span class='hs-conid'>Neg</span>
<a name="line-10"></a><span class='hs-varop'>&gt;</span>   <span class='hs-comment'>-- Type synonyms for convenience.</span>
<a name="line-11"></a><span class='hs-varop'>&gt;</span>   <span class='hs-layout'>,</span> <span class='hs-conid'>Pos1</span><span class='hs-layout'>,</span> <span class='hs-conid'>Pos2</span><span class='hs-layout'>,</span> <span class='hs-conid'>Pos3</span><span class='hs-layout'>,</span> <span class='hs-conid'>Pos4</span><span class='hs-layout'>,</span> <span class='hs-conid'>Pos5</span><span class='hs-layout'>,</span> <span class='hs-conid'>Neg1</span><span class='hs-layout'>,</span> <span class='hs-conid'>Neg2</span><span class='hs-layout'>,</span> <span class='hs-conid'>Neg3</span><span class='hs-layout'>,</span> <span class='hs-conid'>Neg4</span><span class='hs-layout'>,</span> <span class='hs-conid'>Neg5</span>
<a name="line-12"></a><span class='hs-varop'>&gt;</span>   <span class='hs-comment'>-- Values for convenience.</span>
<a name="line-13"></a><span class='hs-varop'>&gt;</span>   <span class='hs-layout'>,</span> <span class='hs-varid'>zero</span><span class='hs-layout'>,</span> <span class='hs-varid'>pos1</span><span class='hs-layout'>,</span> <span class='hs-varid'>pos2</span><span class='hs-layout'>,</span> <span class='hs-varid'>pos3</span><span class='hs-layout'>,</span> <span class='hs-varid'>pos4</span><span class='hs-layout'>,</span> <span class='hs-varid'>pos5</span><span class='hs-layout'>,</span> <span class='hs-varid'>neg1</span><span class='hs-layout'>,</span> <span class='hs-varid'>neg2</span><span class='hs-layout'>,</span> <span class='hs-varid'>neg3</span><span class='hs-layout'>,</span> <span class='hs-varid'>neg4</span><span class='hs-layout'>,</span> <span class='hs-varid'>neg5</span>
<a name="line-14"></a><span class='hs-varop'>&gt;</span>   <span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
</pre>
<pre><a name="line-1"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>import</span> <span class='hs-conid'>Prelude</span> <span class='hs-varid'>hiding</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varop'>*</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varop'>/</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varop'>+</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-comment'>-</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>negate</span><span class='hs-layout'>)</span>
<a name="line-2"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>Prelude</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varop'>+</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-comment'>-</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-3"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Typeable</span> <span class='hs-layout'>(</span><span class='hs-conid'>Typeable</span><span class='hs-layout'>)</span>
</pre>
Use the same fixity for operators as the Prelude.

<pre><a name="line-1"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>infixl</span> <span class='hs-num'>7</span>  <span class='hs-varop'>*</span><span class='hs-layout'>,</span> <span class='hs-varop'>/</span>
<a name="line-2"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>infixl</span> <span class='hs-num'>6</span>  <span class='hs-varop'>+</span><span class='hs-layout'>,</span> <span class='hs-comment'>-</span>
</pre>

= NumTypes =

We start by defining a class encompassing all integers with the
class function 'toNum' that converts from the type-level to a
value-level 'Num'.

<pre><a name="line-1"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>class</span> <span class='hs-conid'>NumTypeI</span> <span class='hs-varid'>n</span> <span class='hs-keyword'>where</span> <span class='hs-varid'>toNum</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Num</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span>
</pre>
Then we define classes encompassing all positive and negative
integers respectively. The 'PosTypeI' class corresponds to HList's
'HNat'. We also define a class for non-zero numbers (used to
prohibit division by zero).

<pre><a name="line-1"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>class</span> <span class='hs-layout'>(</span><span class='hs-conid'>NumTypeI</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>PosTypeI</span> <span class='hs-varid'>n</span>
<a name="line-2"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>class</span> <span class='hs-layout'>(</span><span class='hs-conid'>NumTypeI</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>NegTypeI</span> <span class='hs-varid'>n</span>
<a name="line-3"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>class</span> <span class='hs-layout'>(</span><span class='hs-conid'>NumTypeI</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>NonZeroI</span> <span class='hs-varid'>n</span>
</pre>
Now we use a trick from Oleg Kiselyov and Chung-chieh Shan [2]:

    -- The well-formedness condition, the kind predicate
    class Nat0 a where toInt :: a -> Int
    class Nat0 a => Nat a           -- (positive) naturals

    -- To prevent the user from adding new instances to Nat0 and especially
    -- to Nat (e.g., to prevent the user from adding the instance |Nat B0|)
    -- we do NOT export Nat0 and Nat. Rather, we export the following proxies.
    -- The proxies entail Nat and Nat0 and so can be used to add Nat and Nat0
    -- constraints in the signatures. However, all the constraints below
    -- are expressed in terms of Nat0 and Nat rather than proxies. Thus,
    -- even if the user adds new instances to proxies, it would not matter.
    -- Besides, because the following proxy instances are most general,
    -- one may not add further instances without overlapping instance extension.
    class    Nat0 n => Nat0E n
    instance Nat0 n => Nat0E n
    class    Nat n => NatE n
    instance Nat n => NatE n

We apply this trick to our classes. In our case we will elect to
append an "I" to the internal (non-exported) classes rather than
appending an "E" to the exported classes.

<pre><a name="line-1"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>class</span>    <span class='hs-layout'>(</span><span class='hs-conid'>NumTypeI</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>NumType</span> <span class='hs-varid'>n</span>
<a name="line-2"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>NumTypeI</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>NumType</span> <span class='hs-varid'>n</span>
<a name="line-3"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>class</span>    <span class='hs-layout'>(</span><span class='hs-conid'>PosTypeI</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>PosType</span> <span class='hs-varid'>n</span>
<a name="line-4"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>PosTypeI</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>PosType</span> <span class='hs-varid'>n</span>
<a name="line-5"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>class</span>    <span class='hs-layout'>(</span><span class='hs-conid'>NegTypeI</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>NegType</span> <span class='hs-varid'>n</span>
<a name="line-6"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>NegTypeI</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>NegType</span> <span class='hs-varid'>n</span>
<a name="line-7"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>class</span>    <span class='hs-layout'>(</span><span class='hs-conid'>NonZeroI</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>NonZero</span> <span class='hs-varid'>n</span>
<a name="line-8"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>NonZeroI</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>NonZero</span> <span class='hs-varid'>n</span>
</pre>
We do not have to do this for our other classes. They have the above
classes in their constraints and since the instances are complete
(not proven) a new instance cannot be defined (actually used in the
case of GHC) without overlapping instances.

Now we Define the data types used to represent integers. We begin
with 'Zero', which we allow to be used as both a positive and a
negative number in the sense of the previously defined type classes.
'Zero' corresponds to HList's 'HZero'.

<pre><a name="line-1"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>data</span> <span class='hs-conid'>Zero</span> <span class='hs-keyword'>deriving</span> <span class='hs-conid'>Typeable</span>
<a name="line-2"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>NumTypeI</span> <span class='hs-conid'>Zero</span> <span class='hs-keyword'>where</span> <span class='hs-varid'>toNum</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-num'>0</span>
<a name="line-3"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>PosTypeI</span> <span class='hs-conid'>Zero</span>
<a name="line-4"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>NegTypeI</span> <span class='hs-conid'>Zero</span>
</pre>
Next we define the "successor" type, here called 'Pos' (corresponding
to HList's 'HSucc').

<pre><a name="line-1"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>data</span> <span class='hs-conid'>Pos</span> <span class='hs-varid'>n</span> <span class='hs-keyword'>deriving</span> <span class='hs-conid'>Typeable</span>
<a name="line-2"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>PosTypeI</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>NumTypeI</span> <span class='hs-layout'>(</span><span class='hs-conid'>Pos</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-3"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>toNum</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>toNum</span> <span class='hs-layout'>(</span><span class='hs-varid'>undefined</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-conid'>Prelude</span><span class='hs-varop'>.+</span> <span class='hs-num'>1</span>
<a name="line-4"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>PosTypeI</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>PosTypeI</span> <span class='hs-layout'>(</span><span class='hs-conid'>Pos</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span>
<a name="line-5"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>PosTypeI</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>NonZeroI</span> <span class='hs-layout'>(</span><span class='hs-conid'>Pos</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span>
</pre>
We could be more restrictive using "data (PosTypeI n) => Pos n" but
this constraint will not be checked (by GHC) anyway when 'Pos' is
used solely at the type level.

Finally we define the "predecessor" type used to represent negative
numbers.

<pre><a name="line-1"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>data</span> <span class='hs-conid'>Neg</span> <span class='hs-varid'>n</span> <span class='hs-keyword'>deriving</span> <span class='hs-conid'>Typeable</span>
<a name="line-2"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>NegTypeI</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>NumTypeI</span> <span class='hs-layout'>(</span><span class='hs-conid'>Neg</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-3"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>toNum</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>toNum</span> <span class='hs-layout'>(</span><span class='hs-varid'>undefined</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-conid'>Prelude</span><span class='hs-varop'>.-</span> <span class='hs-num'>1</span>
<a name="line-4"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>NegTypeI</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>NegTypeI</span> <span class='hs-layout'>(</span><span class='hs-conid'>Neg</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span>
<a name="line-5"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>NegTypeI</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>NonZeroI</span> <span class='hs-layout'>(</span><span class='hs-conid'>Neg</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span>
</pre>

= Show instances =

For convenience we create show instances for the defined NumTypes.

<pre><a name="line-1"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>Show</span> <span class='hs-conid'>Zero</span> <span class='hs-keyword'>where</span> <span class='hs-varid'>show</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-str'>"NumType 0"</span>
<a name="line-2"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>PosTypeI</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Show</span> <span class='hs-layout'>(</span><span class='hs-conid'>Pos</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span> <span class='hs-varid'>show</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>=</span> <span class='hs-str'>"NumType "</span> <span class='hs-varop'>++</span> <span class='hs-varid'>show</span> <span class='hs-layout'>(</span><span class='hs-varid'>toNum</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Integer</span><span class='hs-layout'>)</span>
<a name="line-3"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>NegTypeI</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Show</span> <span class='hs-layout'>(</span><span class='hs-conid'>Neg</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span> <span class='hs-varid'>show</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>=</span> <span class='hs-str'>"NumType "</span> <span class='hs-varop'>++</span> <span class='hs-varid'>show</span> <span class='hs-layout'>(</span><span class='hs-varid'>toNum</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Integer</span><span class='hs-layout'>)</span>
</pre>

= Negation, incrementing and decrementing =

We start off with some basic building blocks. Negation is a simple
matter of recursively changing 'Pos' to 'Neg' or vice versa while
leaving 'Zero' unchanged.

<pre><a name="line-1"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>class</span> <span class='hs-layout'>(</span><span class='hs-conid'>NumTypeI</span> <span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>NumTypeI</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Negate</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span><span class='hs-layout'>,</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span>
</pre>
<pre><a name="line-1"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>Negate</span> <span class='hs-conid'>Zero</span> <span class='hs-conid'>Zero</span>
<a name="line-2"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>PosTypeI</span> <span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>NegTypeI</span> <span class='hs-varid'>b</span><span class='hs-layout'>,</span> <span class='hs-conid'>Negate</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Negate</span> <span class='hs-layout'>(</span><span class='hs-conid'>Pos</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Neg</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>
<a name="line-3"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>NegTypeI</span> <span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>PosTypeI</span> <span class='hs-varid'>b</span><span class='hs-layout'>,</span> <span class='hs-conid'>Negate</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Negate</span> <span class='hs-layout'>(</span><span class='hs-conid'>Neg</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Pos</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>
</pre>
We define a type class for incrementing and decrementing NumTypes.
The 'incr' and 'decr' functions correspond roughly to HList's 'hSucc'
and 'hPred' respectively.

<pre><a name="line-1"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>class</span> <span class='hs-layout'>(</span><span class='hs-conid'>NumTypeI</span> <span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>NumTypeI</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Succ</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span><span class='hs-layout'>,</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span>
</pre>
To increment NumTypes we either prepend 'Pos' to numbers greater
than or equal to Zero or remove a 'Neg' from numbers less than Zero.

<pre><a name="line-1"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>Succ</span> <span class='hs-conid'>Zero</span> <span class='hs-layout'>(</span><span class='hs-conid'>Pos</span> <span class='hs-conid'>Zero</span><span class='hs-layout'>)</span>
<a name="line-2"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>PosTypeI</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Succ</span> <span class='hs-layout'>(</span><span class='hs-conid'>Pos</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Pos</span> <span class='hs-layout'>(</span><span class='hs-conid'>Pos</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-3"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>Succ</span> <span class='hs-layout'>(</span><span class='hs-conid'>Neg</span> <span class='hs-conid'>Zero</span><span class='hs-layout'>)</span> <span class='hs-conid'>Zero</span>
<a name="line-4"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>NegTypeI</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Succ</span> <span class='hs-layout'>(</span><span class='hs-conid'>Neg</span> <span class='hs-layout'>(</span><span class='hs-conid'>Neg</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Neg</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
</pre>

= Addition and subtraction =

Now let us move on towards more complex arithmetic operations. We
define a class for addition and subtraction of NumTypes.

<pre><a name="line-1"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>class</span> <span class='hs-layout'>(</span><span class='hs-conid'>Add</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-varid'>c</span><span class='hs-layout'>,</span> <span class='hs-conid'>Sub</span> <span class='hs-varid'>c</span> <span class='hs-varid'>b</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-2"></a><span class='hs-varop'>&gt;</span>    <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Sum</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>c</span><span class='hs-layout'>,</span> <span class='hs-varid'>a</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span><span class='hs-layout'>,</span> <span class='hs-varid'>b</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span>
</pre>
In order to provide instances satisfying the functional dependencies
of 'Sum', in particular the property that any two parameters uniquely
define the third, we must use helper classes.

<pre><a name="line-1"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>class</span> <span class='hs-layout'>(</span><span class='hs-conid'>NumTypeI</span> <span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>NumTypeI</span> <span class='hs-varid'>b</span><span class='hs-layout'>,</span> <span class='hs-conid'>NumTypeI</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Add</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>c</span>
<a name="line-2"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>class</span> <span class='hs-layout'>(</span><span class='hs-conid'>NumTypeI</span> <span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>NumTypeI</span> <span class='hs-varid'>b</span><span class='hs-layout'>,</span> <span class='hs-conid'>NumTypeI</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Sub</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>c</span>
</pre>
Adding anything to Zero gives "anything".

<pre><a name="line-1"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>NumTypeI</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Add</span> <span class='hs-conid'>Zero</span> <span class='hs-varid'>a</span> <span class='hs-varid'>a</span>
</pre>
When adding to a non-Zero number our strategy is to "transfer" type
constructors from the first type to the second type until the first
type is Zero. We use the 'Succ' class to do this.

<pre><a name="line-1"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>PosTypeI</span> <span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>Succ</span> <span class='hs-varid'>b</span> <span class='hs-varid'>c</span><span class='hs-layout'>,</span> <span class='hs-conid'>Add</span> <span class='hs-varid'>a</span> <span class='hs-varid'>c</span> <span class='hs-varid'>d</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Add</span> <span class='hs-layout'>(</span><span class='hs-conid'>Pos</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-varid'>b</span> <span class='hs-varid'>d</span>
<a name="line-2"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>NegTypeI</span> <span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>Succ</span> <span class='hs-varid'>c</span> <span class='hs-varid'>b</span><span class='hs-layout'>,</span> <span class='hs-conid'>Add</span> <span class='hs-varid'>a</span> <span class='hs-varid'>c</span> <span class='hs-varid'>d</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Add</span> <span class='hs-layout'>(</span><span class='hs-conid'>Neg</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-varid'>b</span> <span class='hs-varid'>d</span>
</pre>
We define our helper class for subtraction analogously.

<pre><a name="line-1"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>NumType</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Sub</span> <span class='hs-varid'>a</span> <span class='hs-conid'>Zero</span> <span class='hs-varid'>a</span>
<a name="line-2"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>Succ</span> <span class='hs-varid'>a'</span> <span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>PosTypeI</span> <span class='hs-varid'>b</span><span class='hs-layout'>,</span> <span class='hs-conid'>Sub</span> <span class='hs-varid'>a'</span> <span class='hs-varid'>b</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Sub</span> <span class='hs-varid'>a</span> <span class='hs-layout'>(</span><span class='hs-conid'>Pos</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-varid'>c</span>
<a name="line-3"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>Succ</span> <span class='hs-varid'>a</span> <span class='hs-varid'>a'</span><span class='hs-layout'>,</span> <span class='hs-conid'>NegTypeI</span> <span class='hs-varid'>b</span><span class='hs-layout'>,</span> <span class='hs-conid'>Sub</span> <span class='hs-varid'>a'</span> <span class='hs-varid'>b</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Sub</span> <span class='hs-varid'>a</span> <span class='hs-layout'>(</span><span class='hs-conid'>Neg</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-varid'>c</span>
</pre>
While we cold have defined a single 'Sub' instance using negation and
addition.

] instance (Negate b b', Add a b' c) => Sub a b c

However, the constraints of such a 'Sub' instance which are not
also constraints of the 'Sub' class can complicate type signatures
(is this true or was I confused by other issues at the time?). Thus
we elect to use the lower level instances analoguous to the 'Add'
instances.

Using the helper classes we can provide an instance of 'Sum' that
satisfies its functional dependencies. We provide an instance of
'Sum' in terms of 'Add' and 'Sub'.

<pre><a name="line-1"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>Add</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-varid'>c</span><span class='hs-layout'>,</span> <span class='hs-conid'>Sub</span> <span class='hs-varid'>c</span> <span class='hs-varid'>b</span> <span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>Sub</span> <span class='hs-varid'>c</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Sum</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-varid'>c</span>
</pre>

= Division =

We will do division on NumTypes before we do multiplication. This
may be surprising but it will in fact simplify the multiplication.
The reason for this is that we can have a "reverse" functional
dependency for division but not for multiplication. Consider the
expressions "x / y = z". If y and z are known we can always determine
x. However, in "x * y = z" we can not determine x if y and z are
zero.

The 'NonZeroI' class is used as a constraint on the denominator 'b'
in our 'Div' class.

<pre><a name="line-1"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>class</span> <span class='hs-layout'>(</span><span class='hs-conid'>NumTypeI</span> <span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>NonZeroI</span> <span class='hs-varid'>b</span><span class='hs-layout'>,</span> <span class='hs-conid'>NumTypeI</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Div</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>c</span><span class='hs-layout'>,</span> <span class='hs-varid'>c</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span>
</pre>
Zero divided by anything (we don't bother with infinity) equals
zero.

<pre><a name="line-1"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>NonZeroI</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Div</span> <span class='hs-conid'>Zero</span> <span class='hs-varid'>n</span> <span class='hs-conid'>Zero</span>
</pre>
Note that We could omit the 'NonZeroI' class completely and instead
provide the following two instances.

] instance (PosTypeI n) => Div Zero (Pos n) Zero
] instance (NegTypeI n) => Div Zero (Neg n) Zero

Going beyond zero numbers we start with a base case with all numbers
positive. We recursively subtract the denominator from nominator
while incrementing the result, until we reach the zero case.

<pre><a name="line-1"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span> <span class='hs-conid'>Sum</span> <span class='hs-varid'>n'</span> <span class='hs-layout'>(</span><span class='hs-conid'>Pos</span> <span class='hs-varid'>n''</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Pos</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span>
<a name="line-2"></a><span class='hs-varop'>&gt;</span>          <span class='hs-layout'>,</span> <span class='hs-conid'>Div</span> <span class='hs-varid'>n''</span> <span class='hs-layout'>(</span><span class='hs-conid'>Pos</span> <span class='hs-varid'>n'</span><span class='hs-layout'>)</span> <span class='hs-varid'>n'''</span><span class='hs-layout'>,</span> <span class='hs-conid'>PosTypeI</span> <span class='hs-varid'>n'''</span><span class='hs-layout'>)</span>
<a name="line-3"></a><span class='hs-varop'>&gt;</span>       <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Div</span> <span class='hs-layout'>(</span><span class='hs-conid'>Pos</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Pos</span> <span class='hs-varid'>n'</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Pos</span> <span class='hs-varid'>n'''</span><span class='hs-layout'>)</span>
</pre>
Now we tackle cases with negative numbers involved. We trivially
convert these to the all-positive case and negate the result if
appropriate.

<pre><a name="line-1"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span> <span class='hs-conid'>NegTypeI</span> <span class='hs-varid'>n</span><span class='hs-layout'>,</span> <span class='hs-conid'>NegTypeI</span> <span class='hs-varid'>n'</span>
<a name="line-2"></a><span class='hs-varop'>&gt;</span>          <span class='hs-layout'>,</span> <span class='hs-conid'>Negate</span> <span class='hs-varid'>n</span> <span class='hs-varid'>p</span><span class='hs-layout'>,</span> <span class='hs-conid'>Negate</span> <span class='hs-varid'>n'</span> <span class='hs-varid'>p'</span>
<a name="line-3"></a><span class='hs-varop'>&gt;</span>          <span class='hs-layout'>,</span> <span class='hs-conid'>Div</span> <span class='hs-layout'>(</span><span class='hs-conid'>Pos</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Pos</span> <span class='hs-varid'>p'</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Pos</span> <span class='hs-varid'>p''</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-4"></a><span class='hs-varop'>&gt;</span>       <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Div</span> <span class='hs-layout'>(</span><span class='hs-conid'>Neg</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Neg</span> <span class='hs-varid'>n'</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Pos</span> <span class='hs-varid'>p''</span><span class='hs-layout'>)</span>
<a name="line-5"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span> <span class='hs-conid'>NegTypeI</span> <span class='hs-varid'>n</span><span class='hs-layout'>,</span> <span class='hs-conid'>Negate</span> <span class='hs-varid'>n</span> <span class='hs-varid'>p'</span>
<a name="line-6"></a><span class='hs-varop'>&gt;</span>          <span class='hs-layout'>,</span> <span class='hs-conid'>Div</span> <span class='hs-layout'>(</span><span class='hs-conid'>Pos</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Pos</span> <span class='hs-varid'>p'</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Pos</span> <span class='hs-varid'>p''</span><span class='hs-layout'>)</span>
<a name="line-7"></a><span class='hs-varop'>&gt;</span>          <span class='hs-layout'>,</span> <span class='hs-conid'>Negate</span> <span class='hs-layout'>(</span><span class='hs-conid'>Pos</span> <span class='hs-varid'>p''</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Neg</span> <span class='hs-varid'>n''</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-8"></a><span class='hs-varop'>&gt;</span>       <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Div</span> <span class='hs-layout'>(</span><span class='hs-conid'>Pos</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Neg</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Neg</span> <span class='hs-varid'>n''</span><span class='hs-layout'>)</span>
<a name="line-9"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span> <span class='hs-conid'>NegTypeI</span> <span class='hs-varid'>n</span><span class='hs-layout'>,</span> <span class='hs-conid'>Negate</span> <span class='hs-varid'>n</span> <span class='hs-varid'>p'</span>
<a name="line-10"></a><span class='hs-varop'>&gt;</span>          <span class='hs-layout'>,</span> <span class='hs-conid'>Div</span> <span class='hs-layout'>(</span><span class='hs-conid'>Pos</span> <span class='hs-varid'>p'</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Pos</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Pos</span> <span class='hs-varid'>p''</span><span class='hs-layout'>)</span>
<a name="line-11"></a><span class='hs-varop'>&gt;</span>          <span class='hs-layout'>,</span> <span class='hs-conid'>Negate</span> <span class='hs-layout'>(</span><span class='hs-conid'>Pos</span> <span class='hs-varid'>p''</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Neg</span> <span class='hs-varid'>n''</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-12"></a><span class='hs-varop'>&gt;</span>       <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Div</span> <span class='hs-layout'>(</span><span class='hs-conid'>Neg</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Pos</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Neg</span> <span class='hs-varid'>n''</span><span class='hs-layout'>)</span>
</pre>

= Multiplication =

Class for multiplication. Limited by the type checker stack. If the
multiplication is too large this error message will be emitted:

    Context reduction stack overflow; size = 20
    Use -fcontext-stack=N to increase stack size to N

<pre><a name="line-1"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>class</span> <span class='hs-layout'>(</span><span class='hs-conid'>NumTypeI</span> <span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>NumTypeI</span> <span class='hs-varid'>b</span><span class='hs-layout'>,</span> <span class='hs-conid'>NumTypeI</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Mul</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>c</span>
</pre>
Providing instances for the 'Mul' class is really easy thanks to
the 'Div' class having the functional dependency "c b -> a".

<pre><a name="line-1"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>NumTypeI</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Mul</span> <span class='hs-varid'>n</span> <span class='hs-conid'>Zero</span> <span class='hs-conid'>Zero</span>
<a name="line-2"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>PosTypeI</span> <span class='hs-varid'>p</span><span class='hs-layout'>,</span> <span class='hs-conid'>Div</span> <span class='hs-varid'>c</span> <span class='hs-layout'>(</span><span class='hs-conid'>Pos</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Mul</span> <span class='hs-varid'>a</span> <span class='hs-layout'>(</span><span class='hs-conid'>Pos</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-varid'>c</span>
<a name="line-3"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>NegTypeI</span> <span class='hs-varid'>n</span><span class='hs-layout'>,</span> <span class='hs-conid'>Div</span> <span class='hs-varid'>c</span> <span class='hs-layout'>(</span><span class='hs-conid'>Neg</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Mul</span> <span class='hs-varid'>a</span> <span class='hs-layout'>(</span><span class='hs-conid'>Neg</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-varid'>c</span>
</pre>

= Functions =

Using the above type classes we define functions for various
arithmetic operations. All functions are undefined and only operate
on the type level. Their main contribution is that they facilitate
NumType arithmetic without explicit (and tedious) type declarations.

The main reason to collect all functions here is to keep the
preceeding sections free from distraction.

<pre><a name="line-1"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>negate</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Negate</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span>
<a name="line-2"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>negate</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>undefined</span>
</pre>
<pre><a name="line-1"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>incr</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Succ</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span>
<a name="line-2"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>incr</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>undefined</span>
<a name="line-3"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>decr</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Succ</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span>
<a name="line-4"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>decr</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>undefined</span>
</pre>
<pre><a name="line-1"></a><span class='hs-varop'>&gt;</span> <span class='hs-layout'>(</span><span class='hs-varop'>+</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Sum</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>c</span>
<a name="line-2"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>_</span> <span class='hs-varop'>+</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>undefined</span>
<a name="line-3"></a><span class='hs-varop'>&gt;</span> <span class='hs-layout'>(</span><span class='hs-comment'>-</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Sum</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span>
<a name="line-4"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>_</span> <span class='hs-comment'>-</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>undefined</span>
</pre>
<pre><a name="line-1"></a><span class='hs-varop'>&gt;</span> <span class='hs-layout'>(</span><span class='hs-varop'>/</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Div</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>c</span>
<a name="line-2"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>_</span> <span class='hs-varop'>/</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>undefined</span>
</pre>
<pre><a name="line-1"></a><span class='hs-varop'>&gt;</span> <span class='hs-layout'>(</span><span class='hs-varop'>*</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Mul</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>c</span>
<a name="line-2"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>_</span> <span class='hs-varop'>*</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>undefined</span>
</pre>

= Convenince types and values =

Finally we define some type synonyms for the convenience of clients
of the library.

<pre><a name="line-1"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>type</span> <span class='hs-conid'>Pos1</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Pos</span> <span class='hs-conid'>Zero</span>
<a name="line-2"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>type</span> <span class='hs-conid'>Pos2</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Pos</span> <span class='hs-conid'>Pos1</span>
<a name="line-3"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>type</span> <span class='hs-conid'>Pos3</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Pos</span> <span class='hs-conid'>Pos2</span>
<a name="line-4"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>type</span> <span class='hs-conid'>Pos4</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Pos</span> <span class='hs-conid'>Pos3</span>
<a name="line-5"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>type</span> <span class='hs-conid'>Pos5</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Pos</span> <span class='hs-conid'>Pos4</span>
<a name="line-6"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>type</span> <span class='hs-conid'>Neg1</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Neg</span> <span class='hs-conid'>Zero</span>
<a name="line-7"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>type</span> <span class='hs-conid'>Neg2</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Neg</span> <span class='hs-conid'>Neg1</span>
<a name="line-8"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>type</span> <span class='hs-conid'>Neg3</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Neg</span> <span class='hs-conid'>Neg2</span>
<a name="line-9"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>type</span> <span class='hs-conid'>Neg4</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Neg</span> <span class='hs-conid'>Neg3</span>
<a name="line-10"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>type</span> <span class='hs-conid'>Neg5</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Neg</span> <span class='hs-conid'>Neg4</span>
</pre>
Analogously we also define some convenience values (all 'undefined'
but with the expected types).

<pre><a name="line-1"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>zero</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Zero</span>  <span class='hs-comment'>-- ~ hZero</span>
<a name="line-2"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>zero</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>undefined</span>
<a name="line-3"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>pos1</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Pos1</span>
<a name="line-4"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>pos1</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>incr</span> <span class='hs-varid'>zero</span>
<a name="line-5"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>pos2</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Pos2</span>
<a name="line-6"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>pos2</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>incr</span> <span class='hs-varid'>pos1</span>
<a name="line-7"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>pos3</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Pos3</span>
<a name="line-8"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>pos3</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>incr</span> <span class='hs-varid'>pos2</span>
<a name="line-9"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>pos4</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Pos4</span>
<a name="line-10"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>pos4</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>incr</span> <span class='hs-varid'>pos3</span>
<a name="line-11"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>pos5</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Pos5</span>
<a name="line-12"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>pos5</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>incr</span> <span class='hs-varid'>pos4</span>
<a name="line-13"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>neg1</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Neg1</span>
<a name="line-14"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>neg1</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>decr</span> <span class='hs-varid'>zero</span>
<a name="line-15"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>neg2</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Neg2</span>
<a name="line-16"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>neg2</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>decr</span> <span class='hs-varid'>neg1</span>
<a name="line-17"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>neg3</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Neg3</span>
<a name="line-18"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>neg3</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>decr</span> <span class='hs-varid'>neg2</span>
<a name="line-19"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>neg4</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Neg4</span>
<a name="line-20"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>neg4</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>decr</span> <span class='hs-varid'>neg3</span>
<a name="line-21"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>neg5</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Neg5</span>
<a name="line-22"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>neg5</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>decr</span> <span class='hs-varid'>neg4</span>
</pre>

= References =

[1] http://homepages.cwi.nl/~ralf/HList/
[2] http://okmij.org/ftp/Computation/resource-aware-prog/BinaryNumber.hs

</body>
</html>
