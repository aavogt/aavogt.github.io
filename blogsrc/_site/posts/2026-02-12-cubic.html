<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Blog - Cubic equation solving</title>
        <link rel="stylesheet" href="../css/default.css" />
    </head>
    <body>
        <header>
            <div class="logo">
                <a href="../">aavogt</a>
            </div>
            <nav>
                <a href="../">Home</a>
                <a href="../archive.html">Archive</a>
            </nav>
        </header>

        <main role="main">
            <h1>Cubic equation solving</h1>
            <article>
    <section class="header">
        Posted on February 12, 2026
        
    </section>
    <section>
        <p>I was not sure about which method to use for solving cubic equation, as I am using cubic smoothing splines in the handwriting project <code>wip/gregg-board-rs</code> and I would like to iterate over roots when inferring features like baselines. I tried three methods, is a <a href="https://en.wikipedia.org/wiki/Cubic_equation">cubic equation</a> actually just the version maxima produces with</p>
<pre><code>load(&quot;codegen.mac&quot;);
sum(a[i] * x^(3-i), i, 0, 3)$
solve(%, x);
fullratsimp(%);
roots : map(rhs, %), numer;
with_stdout(&quot;cubic_gen.rs&quot;, codegen(roots));</code></pre>
<p>With some adjustment needed as my codegen.mac doesn’t quite track the necessary c64() coercions.
It’s almost bad enough to go back to generating c and then figure out bindgen/ffi. Below we’ll refer to it as <code>radicals</code></p>
<p>The second option is to make the Frobenius companion matrix and find it’s eigenvalues which are exactly the roots of the polynomial. In this case we use <code>lapacke</code> zgeev. The last and best option is <a href="https://crates.io/crates/rpoly">rpoly</a>, but it’s still interesting to find out exactly how much better in terms of speed and accuracy.</p>
<p>The input polynomials are specified in terms of their roots. Two roots are point on a unit square according <a href="https://cran.r-project.org/web/packages/lhs/index.html">lhs::geneticLHS</a>, and the other root is 1. Then I get the time needed to solve it 100 times and calculate error. Here are the results:</p>
<p><img src="../images/cubic_accuracy.png" /></p>
<p>It’s slightly suspect that occasionally error.abs is less than one ulp? I used <code>double ulp = 1. - nextafter(1, 2) = 2.22e-16</code>. I add up the error from the 100 replicates so if most of the replicates have 0 error it seems plausible. Please continue to question, but the rest of the story makes sense: <code>rpoly</code> is usually more accurate as most the points are below the dotted line error.abs(rpoly) = error.abs(lapacke). The cubic equation <code>radicals</code> is much less accurate than either (10 to 10000 times) so it’s plotted as color where light blue is <span class="math inline">10<sup>4</sup></span> and dark blue is <span class="math inline">10<sup>0</sup></span> times slower than the average.</p>
<p>In the next plot we have execution time in seconds. Here <code>lapake</code> is 10-40 times slower than <code>radicals</code>, and <code>rpoly</code> is usually slower than <code>radicals</code></p>
<p><img src="../images/cubic_time.png" /></p>
<p>How much? It’s hard to tell exactly so here’s another plot, where we take the y/x values in the above plot and show how frequently different values occur. On average <code>rpoly</code> takes 10-15% longer, but occasionally can take 3 times as long.</p>
<p><img src="../images/cubic_time2.png" /></p>
<p>It would be nice to continue this topic with a search for parameters to get equal time or equal accuracy. For example <code>Complex&lt;f128&gt;</code> for some subexpressions in <code>radicals</code> might fix the accuracy and there could be a way to .
A <a href="https://gist.github.com/aavogt/595195c7eaf17972c5a85c55fd7bd350">EPM</a> might help to find the map or formula to decide between methods.</p>
    </section>
</article>

        </main>

        <footer>
            Site proudly generated by
            <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </footer>
    </body>
</html>
